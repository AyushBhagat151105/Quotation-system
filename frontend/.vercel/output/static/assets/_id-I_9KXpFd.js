import{S as g,s as y,h as p,g as v,n as j,e as w,r as l,f as N,i as C,c as E,k as R,j as t,t as O}from"./index-CjKGLORb.js";import{u as k}from"./useQuery-vpdnFCOo.js";import{q as x}from"./quotation-B4L4haJ9.js";import{B as d}from"./button-B-x8lPpO.js";import{L as b}from"./loader-circle-8jTwx9-1.js";import{C as M}from"./circle-check-big-bFqHtdYo.js";import{m as f}from"./proxy-CDIbDDQB.js";var S=class extends g{#e;#i=void 0;#t;#s;constructor(e,s){super(),this.#e=e,this.setOptions(s),this.bindMethods(),this.#r()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){const s=this.options;this.options=this.#e.defaultMutationOptions(e),y(this.options,s)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#t,observer:this}),s?.mutationKey&&this.options.mutationKey&&p(s.mutationKey)!==p(this.options.mutationKey)?this.reset():this.#t?.state.status==="pending"&&this.#t.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#t?.removeObserver(this)}onMutationUpdate(e){this.#r(),this.#a(e)}getCurrentResult(){return this.#i}reset(){this.#t?.removeObserver(this),this.#t=void 0,this.#r(),this.#a()}mutate(e,s){return this.#s=s,this.#t?.removeObserver(this),this.#t=this.#e.getMutationCache().build(this.#e,this.options),this.#t.addObserver(this),this.#t.execute(e)}#r(){const e=this.#t?.state??v();this.#i={...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset}}#a(e){j.batch(()=>{if(this.#s&&this.hasListeners()){const s=this.#i.variables,n=this.#i.context,i={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};e?.type==="success"?(this.#s.onSuccess?.(e.data,s,n,i),this.#s.onSettled?.(e.data,null,s,n,i)):e?.type==="error"&&(this.#s.onError?.(e.error,s,n,i),this.#s.onSettled?.(void 0,e.error,s,n,i))}this.listeners.forEach(s=>{s(this.#i)})})}};function q(e,s){const n=w(),[i]=l.useState(()=>new S(n,e));l.useEffect(()=>{i.setOptions(e)},[i,e]);const o=l.useSyncExternalStore(l.useCallback(r=>i.subscribe(j.batchCalls(r)),[i]),()=>i.getCurrentResult(),()=>i.getCurrentResult()),h=l.useCallback((r,c)=>{i.mutate(r,c).catch(N)},[i]);if(o.error&&C(i.options.throwOnError,[o.error]))throw o.error;return{...o,mutate:h,mutateAsync:o.mutate}}const P=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],K=E("circle-x",P);function B(){const{id:e}=R({from:"/quotation-public/$id"}),[s,n]=l.useState(!1),[i,o]=l.useState(""),h=k({queryKey:["quotation-public",e],queryFn:()=>x.publicView(e).then(a=>a.data)}),{data:r,isLoading:c}=h,m=q({mutationFn:a=>x.clientRespond(e,a),onSuccess:()=>{O.success("Response submitted!"),h.refetch(),n(!1)}});if(c)return t.jsx("div",{className:"text-white p-10 flex justify-center",children:t.jsx(b,{className:"animate-spin"})});const u=r.status==="APPROVED"||r.status==="REJECTED"||r.status==="EXPIRED";return t.jsx("div",{className:"min-h-screen p-8 text-white flex justify-center",children:t.jsxs(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"w-full max-w-2xl bg-white/5 p-8 rounded-2xl border border-white/10 backdrop-blur-xl shadow-xl",children:[t.jsx("h1",{className:`text-4xl font-bold text-center 
          bg-linear-to-r from-pink-400 to-purple-400 bg-clip-text text-transparent mb-6`,children:"Quotation Preview"}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("p",{children:[t.jsx("strong",{children:"Client:"})," ",r.clientName]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Email:"})," ",r.clientEmail]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Status:"})," ",r.status]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Total:"})," ₹",r.totalAmount]})]}),t.jsx("h2",{className:"text-xl font-semibold mt-6",children:"Items"}),t.jsx("div",{className:"space-y-3",children:r.items.map(a=>t.jsxs("div",{className:"p-4 bg-white/10 rounded-lg",children:[t.jsx("p",{className:"font-bold",children:a.itemName}),t.jsx("p",{className:"text-white/70",children:a.description}),t.jsxs("p",{children:["Qty: ",a.quantity]}),t.jsxs("p",{children:["Total: ₹",a.totalPrice]})]},a.id))}),r.clientComment&&t.jsxs("div",{className:"mt-6 p-4 bg-red-500/20 border border-red-400/30 rounded-lg",children:[t.jsx("p",{className:"font-semibold text-red-300 mb-1",children:"Client Response:"}),t.jsx("p",{className:"text-red-200",children:r.clientComment})]}),t.jsxs("div",{className:"mt-8 flex flex-col md:flex-row gap-4 justify-center",children:[t.jsxs(d,{disabled:u,className:"flex items-center gap-2 bg-green-600 hover:bg-green-700 w-full md:w-auto",onClick:()=>m.mutate({status:"APPROVED"}),children:[t.jsx(M,{className:"w-5 h-5"}),"Approve"]}),t.jsxs(d,{disabled:u,className:"flex items-center gap-2 bg-red-600 hover:bg-red-700 w-full md:w-auto",onClick:()=>n(!0),children:[t.jsx(K,{className:"w-5 h-5"}),"Reject"]})]}),u&&t.jsx("p",{className:"text-center text-white/60 mt-4",children:"You have already responded to this quotation."}),s&&t.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50",children:t.jsxs(f.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-white/10 border border-white/20 p-6 rounded-xl w-full max-w-md backdrop-blur-xl shadow-2xl",children:[t.jsx("h3",{className:"text-xl font-bold mb-3",children:"Reason for Rejection"}),t.jsx("textarea",{className:"w-full bg-white/10 border border-white/20 rounded-lg p-3 text-white",rows:4,placeholder:"Write your reason...",onChange:a=>o(a.target.value)}),t.jsxs("div",{className:"flex justify-end gap-3 mt-4",children:[t.jsx(d,{variant:"ghost",className:"text-white",onClick:()=>n(!1),children:"Cancel"}),t.jsx(d,{className:"bg-red-600 hover:bg-red-700",onClick:()=>m.mutate({status:"REJECTED",comment:i}),disabled:c,children:c?t.jsx(b,{className:"animate-spin w-5 h-5 text-white"}):"Submit"})]})]})})]})})}export{B as component};
