import{j as e,k as b,r as d,t as h}from"./index-CjKGLORb.js";import{u as w}from"./useQuery-vpdnFCOo.js";import{q as p}from"./quotation-B4L4haJ9.js";import{B as m}from"./button-B-x8lPpO.js";import{m as n}from"./proxy-CDIbDDQB.js";import{L as N}from"./loader-circle-8jTwx9-1.js";import{S as y}from"./send-DyihNU2j.js";function v({success:a}){return e.jsx("div",{className:"flex items-center justify-center w-full py-6",children:a?e.jsx(n.svg,{width:"80",height:"80",viewBox:"0 0 24 24",fill:"none",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},children:e.jsx(n.path,{d:"M20 6L9 17L4 12",stroke:"#34D399",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",initial:{pathLength:0},animate:{pathLength:1},transition:{duration:1}})}):e.jsx(n.svg,{width:"80",height:"80",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:e.jsx(n.path,{d:"M2 21L23 12L2 3V10L17 12L2 14V21Z",stroke:"#ff64d4",strokeWidth:"2",strokeLinejoin:"round",initial:{pathLength:0},animate:{pathLength:1},transition:{duration:1.2}})})})}function R(){const{id:a}=b({from:"/dashboard/quotations/$id/"}),[u,o]=d.useState(!1),[l,x]=d.useState(!1),[r,c]=d.useState(!1),{data:j,isLoading:f}=w({queryKey:["quotation",a],queryFn:()=>p.getOne(a).then(t=>t.data)});if(f)return e.jsx("div",{className:"flex justify-center p-10",children:e.jsx(N,{className:"animate-spin text-white"})});const s=j,i=s.responses?.filter(t=>t.status==="APPROVED"||t.status==="REJECTED")?.slice(-1)[0],g=async()=>{if(!s?.clientEmail){h.error("Quotation missing client email");return}x(!0),c(!1);try{await p.sendEmail(a,s.clientEmail),c(!0),setTimeout(()=>{o(!1),c(!1)},1400)}catch(t){console.error(t),h.error("Failed to send email. Try again.")}finally{x(!1)}};return e.jsxs("div",{className:"p-8 text-white",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-4xl font-bold bg-linear-to-r from-pink-400 to-purple-400 bg-clip-text text-transparent",children:"Quotation Details"}),e.jsxs(m,{onClick:()=>o(!0),className:"bg-linear-to-r from-blue-500 to-purple-600 shadow-lg hover:opacity-90 flex items-center gap-2",children:[e.jsx(y,{className:"w-4 h-4"}),"Send Email"]})]}),e.jsxs("div",{className:"bg-white/5 p-6 rounded-xl border border-white/10 backdrop-blur-xl space-y-4",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Client:"})," ",s.clientName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," ",s.clientEmail]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Status:"})," ",s.status]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Total:"})," ₹",s.totalAmount]}),e.jsx("h2",{className:"text-xl font-semibold mt-4",children:"Items"}),e.jsx("div",{className:"space-y-3",children:s.items.map(t=>e.jsxs("div",{className:"p-4 bg-white/10 rounded-lg",children:[e.jsx("p",{className:"font-bold",children:t.itemName}),e.jsx("p",{className:"text-white/70",children:t.description}),e.jsxs("p",{children:["Qty: ",t.quantity]}),e.jsxs("p",{children:["Unit: ₹",t.unitPrice]}),e.jsxs("p",{children:["Total: ₹",t.totalPrice]})]},t.id))}),i&&e.jsxs("div",{className:"p-4 bg-red-500/20 border border-red-400/30 rounded-lg mt-4",children:[e.jsx("p",{className:"text-red-300 font-semibold",children:"Client Response:"}),e.jsxs("p",{className:"text-red-200 mt-1",children:["Status: ",i.status]}),i.rejectionComment&&e.jsxs("p",{className:"text-red-200 mt-2",children:["Message: ",i.rejectionComment]}),e.jsxs("p",{className:"text-white/50 text-xs mt-2",children:["At: ",new Date(i.respondedAt).toLocaleString()]}),i.clientIp&&e.jsxs("p",{className:"text-white/50 text-xs",children:["IP: ",i.clientIp]}),i.userAgent&&e.jsxs("p",{className:"text-white/50 text-xs",children:["Device: ",i.userAgent]})]})]}),u&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50","aria-modal":"true",role:"dialog",children:e.jsxs(n.div,{initial:{opacity:0,scale:.95,y:12},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95},transition:{duration:.18},className:`bg-white/10 border border-white/20 p-6 rounded-xl w-full max-w-md 
                 backdrop-blur-xl shadow-2xl relative`,children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Send Quotation"}),e.jsx("p",{className:"text-white/70 text-sm mb-4",children:"This will be sent to:"}),e.jsx("div",{className:"p-3 rounded-lg bg-white/10 border border-white/20 mb-4 text-white",children:s.clientEmail}),e.jsx(v,{success:r}),e.jsxs("div",{className:"mt-4 flex justify-between items-center gap-3",children:[e.jsx("div",{className:"text-sm text-white/80",children:r?"Sent successfully":l?"Sending...":"Ready to send"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(m,{variant:"ghost",className:"text-white",onClick:()=>{l||o(!1)},children:"Cancel"}),e.jsx(m,{disabled:l||r,onClick:g,className:"bg-linear-to-r from-purple-500 to-pink-600",children:l?"Sending...":r?"Sent":"Send Email"})]})]})]})})]})}export{R as component};
